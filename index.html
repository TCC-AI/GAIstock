<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GAIå¯„åº«åº«å­˜é‡æ°´ä½è£œå–®ç³»çµ±</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Microsoft JhengHei', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            text-align: center;
        }

        .header h1 {
            color: #2c3e50;
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .header p {
            color: #7f8c8d;
            font-size: 1.1em;
        }

        .nav-tabs {
            display: flex;
            background: white;
            border-radius: 15px;
            padding: 10px;
            margin-bottom: 20px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            overflow-x: auto;
        }

        .nav-tab {
            flex: 1;
            padding: 12px 20px;
            background: transparent;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            white-space: nowrap;
            font-size: 14px;
            color: #666;
        }

        .nav-tab.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            transform: translateY(-2px);
        }

        .tab-content {
            display: none;
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            animation: fadeIn 0.5s ease;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .kpi-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .kpi-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 8px 32px rgba(0,0,0,0.2);
        }

        .kpi-value {
            font-size: 2.5em;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .kpi-label {
            font-size: 0.9em;
            opacity: 0.9;
        }

        .alert-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .alert-card {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 10px;
            padding: 20px;
        }

        .alert-card.danger {
            background: #f8d7da;
            border-color: #f5c6cb;
        }

        .alert-card.success {
            background: #d4edda;
            border-color: #c3e6cb;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #2c3e50;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s ease;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: all 0.3s ease;
            margin: 5px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
        }

        .btn-success {
            background: linear-gradient(135deg, #56ab2f 0%, #a8e6cf 100%);
            color: white;
        }

        .btn-warning {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .data-table th,
        .data-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #e0e0e0;
        }

        .data-table th {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            font-weight: bold;
        }

        .data-table tr:hover {
            background: #f8f9fa;
        }

        .warehouse-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .warehouse-card {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            border-left: 5px solid #667eea;
        }

        .warehouse-card.freezer {
            border-left-color: #3498db;
        }

        .warehouse-card.chiller {
            border-left-color: #e74c3c;
        }

        .capacity-bar {
            width: 100%;
            height: 20px;
            background: #e0e0e0;
            border-radius: 10px;
            overflow: hidden;
            margin: 10px 0;
        }

        .capacity-fill {
            height: 100%;
            background: linear-gradient(90deg, #56ab2f 0%, #a8e6cf 100%);
            transition: width 0.3s ease;
        }

        .capacity-fill.warning {
            background: linear-gradient(90deg, #f093fb 0%, #f5576c 100%);
        }

        .capacity-fill.danger {
            background: linear-gradient(90deg, #ff416c 0%, #ff4b2b 100%);
        }

        .loading {
            display: none;
            text-align: center;
            padding: 40px;
        }

        .loading.show {
            display: block;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 2s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .quick-actions {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 30px;
        }

        .status-badge {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
        }

        .status-badge.active {
            background: #d4edda;
            color: #155724;
        }

        .status-badge.warning {
            background: #fff3cd;
            color: #856404;
        }

        .status-badge.danger {
            background: #f8d7da;
            color: #721c24;
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            .header h1 {
                font-size: 2em;
            }
            
            .nav-tabs {
                flex-direction: column;
            }
            
            .nav-tab {
                margin-bottom: 5px;
            }
            
            .kpi-grid,
            .alert-grid,
            .form-grid,
            .warehouse-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ­ GAIå¯„åº«åº«å­˜é‡æ°´ä½è£œå–®ç³»çµ±</h1>
            <p>æ™ºèƒ½å†·éˆç‰©æµå€‰å„²ç®¡ç†ç³»çµ± - å†·å‡åº«8åº§ | å†·è—åº«5åº§</p>
        </div>

        <div class="nav-tabs">
            <button class="nav-tab active" onclick="showTab('dashboard')">ğŸ“Š ä¸»æ§é </button>
            <button class="nav-tab" onclick="showTab('customer')">ğŸ‘¥ å®¢æˆ¶éœ€æ±‚</button>
            <button class="nav-tab" onclick="showTab('project')">ğŸ“‹ å¯„åº«å°ˆæ¡ˆ</button>
            <button class="nav-tab" onclick="showTab('sku')">ğŸ“¦ SKUä¸»æª”</button>
            <button class="nav-tab" onclick="showTab('warehouse')">ğŸª å€‰å®¹ç®¡ç†</button>
            <button class="nav-tab" onclick="showTab('forecast')">ğŸ¤– AIé æ¸¬</button>
            <button class="nav-tab" onclick="showTab('safety')">ğŸ›¡ï¸ å®‰å…¨åº«å­˜</button>
            <button class="nav-tab" onclick="showTab('recommendation')">ğŸ’¡ åº«å­˜å»ºè­°</button>
            <button class="nav-tab" onclick="showTab('replenishment')">ğŸ“ è£œå–®ç®¡ç†</button>
            <button class="nav-tab" onclick="showTab('monitoring')">ğŸ“ˆ ç›£æ§å‘Šè­¦</button>
        </div>

        <!-- ä¸»æ§é  -->
        <div id="dashboard" class="tab-content active">
            <h2>ğŸ“Š ç³»çµ±ä¸»æ§é </h2>
            
            <div class="kpi-grid">
                <div class="kpi-card">
                    <div class="kpi-value" id="fillRate">98.5%</div>
                    <div class="kpi-label">Fill Rate</div>
                </div>
                <div class="kpi-card">
                    <div class="kpi-value" id="stockoutRate">1.2%</div>
                    <div class="kpi-label">ç¼ºè²¨ç‡</div>
                </div>
                <div class="kpi-card">
                    <div class="kpi-value" id="turnoverDays">15.3</div>
                    <div class="kpi-label">åº«å­˜é€±è½‰å¤©æ•¸</div>
                </div>
                <div class="kpi-card">
                    <div class="kpi-value" id="freezerUtilization">76%</div>
                    <div class="kpi-label">å†·å‡åº«åˆ©ç”¨ç‡</div>
                </div>
                <div class="kpi-card">
                    <div class="kpi-value" id="chillerUtilization">82%</div>
                    <div class="kpi-label">å†·è—åº«åˆ©ç”¨ç‡</div>
                </div>
                <div class="kpi-card">
                    <div class="kpi-value" id="expiringRate">3.1%</div>
                    <div class="kpi-label">å³æœŸå“å æ¯”</div>
                </div>
            </div>

            <div class="alert-grid">
                <div class="alert-card danger">
                    <h4>ğŸš¨ ç·Šæ€¥å‘Šè­¦</h4>
                    <p>å†·å‡åº«F-03å®¹é‡å·²é”89%ï¼Œå»ºè­°ç«‹å³è™•ç†</p>
                    <small>æ›´æ–°æ™‚é–“: 2025-08-13 20:45</small>
                </div>
                <div class="alert-card warning">
                    <h4>âš ï¸ æ•ˆæœŸé è­¦</h4>
                    <p>3å€‹å“é …å°‡æ–¼7å¤©å…§åˆ°æœŸï¼Œéœ€åŸ·è¡ŒFEFOå‡ºè²¨</p>
                    <small>å½±éŸ¿SKU: 15å€‹</small>
                </div>
                <div class="alert-card success">
                    <h4>âœ… ç³»çµ±æ­£å¸¸</h4>
                    <p>AIé æ¸¬æ¨¡å‹é‹è¡Œæ­£å¸¸ï¼Œé æ¸¬æº–ç¢ºåº¦97.2%</p>
                    <small>æœ€å¾Œæ›´æ–°: 2025-08-13 20:00</small>
                </div>
            </div>

            <div class="quick-actions">
                <button class="btn btn-primary" onclick="refreshDashboard()">ğŸ”„ é‡æ–°æ•´ç†</button>
                <button class="btn btn-success" onclick="runAIForecast()">ğŸ¤– åŸ·è¡ŒAIé æ¸¬</button>
                <button class="btn btn-warning" onclick="generateRecommendation()">ğŸ’¡ ç”¢ç”Ÿåº«å­˜å»ºè­°</button>
                <button class="btn btn-primary" onclick="exportReport()">ğŸ“„ åŒ¯å‡ºå ±è¡¨</button>
            </div>

            <div class="loading" id="dashboardLoading">
                <div class="spinner"></div>
                <p>è¼‰å…¥ä¸­...</p>
            </div>
        </div>

        <!-- å®¢æˆ¶éœ€æ±‚ç¢ºèª -->
        <div id="customer" class="tab-content">
            <h2>ğŸ‘¥ å®¢æˆ¶éœ€æ±‚ç¢ºèª</h2>
            
            <div class="form-grid">
                <div class="form-group">
                    <label>å®¢æˆ¶åç¨±</label>
                    <select id="customerSelect">
                        <option value="">è«‹é¸æ“‡å®¢æˆ¶</option>
                        <option value="customer1">çµ±ä¸€ä¼æ¥­</option>
                        <option value="customer2">ç¾©ç¾é£Ÿå“</option>
                        <option value="customer3">æ„›ä¹‹å‘³</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>æœå‹™æ°´æº–</label>
                    <select id="serviceLevel">
                        <option value="">è«‹é¸æ“‡æœå‹™æ°´æº–</option>
                        <option value="P">Pç´š (99.5%)</option>
                        <option value="Q">Qç´š (97.5%)</option>
                        <option value="R">Rç´š (95%)</option>
                    </select>
                </div>
            </div>

            <div class="form-group">
                <label>å“é …éœ€æ±‚æ¸…å–®</label>
                <textarea id="itemList" rows="5" placeholder="è«‹è¼¸å…¥å“é …ä»£ç¢¼ã€åç¨±ã€é ä¼°éŠ·é‡ç­‰è³‡è¨Š..."></textarea>
            </div>

            <div class="quick-actions">
                <button class="btn btn-primary" onclick="saveCustomerDemand()">ğŸ’¾ å„²å­˜éœ€æ±‚</button>
                <button class="btn btn-success" onclick="importDemandFile()">ğŸ“ åŒ¯å…¥æª”æ¡ˆ</button>
                <button class="btn btn-warning" onclick="calculateSafetyStock()">ğŸ§® è©¦ç®—å®‰å…¨åº«å­˜</button>
            </div>

            <table class="data-table" id="customerDemandTable">
                <thead>
                    <tr>
                        <th>å®¢æˆ¶åç¨±</th>
                        <th>å“é …ä»£ç¢¼</th>
                        <th>å“é …åç¨±</th>
                        <th>é ä¼°éŠ·é‡</th>
                        <th>æœå‹™æ°´æº–</th>
                        <th>ç‹€æ…‹</th>
                        <th>æ“ä½œ</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- å‹•æ…‹è¼‰å…¥è³‡æ–™ -->
                </tbody>
            </table>
        </div>

        <!-- å¯„åº«å°ˆæ¡ˆè¨­å®š -->
        <div id="project" class="tab-content">
            <h2>ğŸ“‹ å¯„åº«å°ˆæ¡ˆè¨­å®š</h2>
            
            <div class="form-grid">
                <div class="form-group">
                    <label>å°ˆæ¡ˆåç¨±</label>
                    <input type="text" id="projectName" placeholder="è«‹è¼¸å…¥å°ˆæ¡ˆåç¨±">
                </div>
                <div class="form-group">
                    <label>å®¢æˆ¶</label>
                    <select id="projectCustomer">
                        <option value="">è«‹é¸æ“‡å®¢æˆ¶</option>
                        <option value="customer1">çµ±ä¸€ä¼æ¥­</option>
                        <option value="customer2">ç¾©ç¾é£Ÿå“</option>
                        <option value="customer3">æ„›ä¹‹å‘³</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>æŒ‡æ´¾å€‰åˆ¥</label>
                    <select id="warehouseAssignment" multiple>
                        <option value="F01">å†·å‡åº«F-01</option>
                        <option value="F02">å†·å‡åº«F-02</option>
                        <option value="F03">å†·å‡åº«F-03</option>
                        <option value="F04">å†·å‡åº«F-04</option>
                        <option value="F05">å†·å‡åº«F-05</option>
                        <option value="F06">å†·å‡åº«F-06</option>
                        <option value="F07">å†·å‡åº«F-07</option>
                        <option value="F08">å†·å‡åº«F-08</option>
                        <option value="C01">å†·è—åº«C-01</option>
                        <option value="C02">å†·è—åº«C-02</option>
                        <option value="C03">å†·è—åº«C-03</option>
                        <option value="C04">å†·è—åº«C-04</option>
                        <option value="C05">å†·è—åº«C-05</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>è¦†æ ¸é€±æœŸ</label>
                    <select id="reviewCycle">
                        <option value="daily">æ¯æ—¥</option>
                        <option value="weekly">æ¯é€±</option>
                        <option value="monthly">æ¯æœˆ</option>
                    </select>
                </div>
            </div>

            <div class="quick-actions">
                <button class="btn btn-primary" onclick="saveProject()">ğŸ’¾ å»ºç«‹å°ˆæ¡ˆ</button>
                <button class="btn btn-success" onclick="activateProject()">âœ… å•Ÿç”¨å°ˆæ¡ˆ</button>
                <button class="btn btn-warning" onclick="copyProject()">ğŸ“‹ è¤‡è£½å°ˆæ¡ˆ</button>
            </div>

            <table class="data-table" id="projectTable">
                <thead>
                    <tr>
                        <th>å°ˆæ¡ˆåç¨±</th>
                        <th>å®¢æˆ¶</th>
                        <th>æŒ‡æ´¾å€‰åˆ¥</th>
                        <th>è¦†æ ¸é€±æœŸ</th>
                        <th>ç‹€æ…‹</th>
                        <th>å»ºç«‹æ™‚é–“</th>
                        <th>æ“ä½œ</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- å‹•æ…‹è¼‰å…¥è³‡æ–™ -->
                </tbody>
            </table>
        </div>

        <!-- SKUä¸»æª” -->
        <div id="sku" class="tab-content">
            <h2>ğŸ“¦ SKUä¸»æª”ç®¡ç†</h2>
            
            <div class="form-grid">
                <div class="form-group">
                    <label>SKUä»£ç¢¼</label>
                    <input type="text" id="skuCode" placeholder="è«‹è¼¸å…¥SKUä»£ç¢¼">
                </div>
                <div class="form-group">
                    <label>å“é …åç¨±</label>
                    <input type="text" id="skuName" placeholder="è«‹è¼¸å…¥å“é …åç¨±">
                </div>
                <div class="form-group">
                    <label>æº«å±¤</label>
                    <select id="temperatureZone">
                        <option value="">è«‹é¸æ“‡æº«å±¤</option>
                        <option value="frozen">å†·å‡ (-18Â°C)</option>
                        <option value="chilled">å†·è— (0-4Â°C)</option>
                        <option value="ambient">å¸¸æº«</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>é«”ç© (mÂ³)</label>
                    <input type="number" id="volume" step="0.001" placeholder="è«‹è¼¸å…¥é«”ç©">
                </div>
                <div class="form-group">
                    <label>é‡é‡ (kg)</label>
                    <input type="number" id="weight" step="0.1" placeholder="è«‹è¼¸å…¥é‡é‡">
                </div>
                <div class="form-group">
                    <label>ä¿å­˜å¤©æ•¸</label>
                    <input type="number" id="shelfLife" placeholder="è«‹è¼¸å…¥ä¿å­˜å¤©æ•¸">
                </div>
            </div>

            <div class="quick-actions">
                <button class="btn btn-primary" onclick="saveSKU()">ğŸ’¾ å„²å­˜SKU</button>
                <button class="btn btn-success" onclick="importSKUFile()">ğŸ“ æ‰¹æ¬¡åŒ¯å…¥</button>
                <button class="btn btn-warning" onclick="validateSKUData()">âœ… è³‡æ–™é©—è­‰</button>
                <button class="btn btn-primary" onclick="exportSKUData()">ğŸ“„ åŒ¯å‡ºè³‡æ–™</button>
            </div>

            <table class="data-table" id="skuTable">
                <thead>
                    <tr>
                        <th>SKUä»£ç¢¼</th>
                        <th>å“é …åç¨±</th>
                        <th>æº«å±¤</th>
                        <th>é«”ç©(mÂ³)</th>
                        <th>é‡é‡(kg)</th>
                        <th>ä¿å­˜å¤©æ•¸</th>
                        <th>ç‹€æ…‹</th>
                        <th>æ“ä½œ</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- å‹•æ…‹è¼‰å…¥è³‡æ–™ -->
                </tbody>
            </table>
        </div>

        <!-- å€‰å®¹ç®¡ç† -->
        <div id="warehouse" class="tab-content">
            <h2>ğŸª å€‰å®¹ç®¡ç†</h2>
            
            <div class="warehouse-grid">
                <!-- å†·å‡åº« -->
                <div class="warehouse-card freezer">
                    <h4>â„ï¸ å†·å‡åº« F-01</h4>
                    <p>æº«åº¦: -18Â°C | ç¸½æ£§æ¿ä½: 120</p>
                    <div class="capacity-bar">
                        <div class="capacity-fill" style="width: 65%"></div>
                    </div>
                    <p>ä½¿ç”¨ç‡: 65% (78/120)</p>
                    <span class="status-badge active">æ­£å¸¸é‹è¡Œ</span>
                </div>
                
                <div class="warehouse-card freezer">
                    <h4>â„ï¸ å†·å‡åº« F-02</h4>
                    <p>æº«åº¦: -18Â°C | ç¸½æ£§æ¿ä½: 120</p>
                    <div class="capacity-bar">
                        <div class="capacity-fill" style="width: 72%"></div>
                    </div>
                    <p>ä½¿ç”¨ç‡: 72% (86/120)</p>
                    <span class="status-badge active">æ­£å¸¸é‹è¡Œ</span>
                </div>
                
                <div class="warehouse-card freezer">
                    <h4>â„ï¸ å†·å‡åº« F-03</h4>
                    <p>æº«åº¦: -18Â°C | ç¸½æ£§æ¿ä½: 120</p>
                    <div class="capacity-bar">
                        <div class="capacity-fill danger" style="width: 89%"></div>
                    </div>
                    <p>ä½¿ç”¨ç‡: 89% (107/120)</p>
                    <span class="status-badge danger">å®¹é‡è­¦å‘Š</span>
                </div>
                
                <div class="warehouse-card freezer">
                    <h4>â„ï¸ å†·å‡åº« F-04</h4>
                    <p>æº«åº¦: -18Â°C | ç¸½æ£§æ¿ä½: 120</p>
                    <div class="capacity-bar">
                        <div class="capacity-fill" style="width: 58%"></div>
                    </div>
                    <p>ä½¿ç”¨ç‡: 58% (70/120)</p>
                    <span class="status-badge active">æ­£å¸¸é‹è¡Œ</span>
                </div>
                
                <!-- å†·è—åº« -->
                <div class="warehouse-card chiller">
                    <h4>ğŸ§Š å†·è—åº« C-01</h4>
                    <p>æº«åº¦: 0-4Â°C | ç¸½æ£§æ¿ä½: 100</p>
                    <div class="capacity-bar">
                        <div class="capacity-fill warning" style="width: 82%"></div>
                    </div>
                    <p>ä½¿ç”¨ç‡: 82% (82/100)</p>
                    <span class="status-badge warning">å®¹é‡åé«˜</span>
                </div>
                
                <div class="warehouse-card chiller">
                    <h4>ğŸ§Š å†·è—åº« C-02</h4>
                    <p>æº«åº¦: 0-4Â°C | ç¸½æ£§æ¿ä½: 100</p>
                    <div class="capacity-bar">
                        <div class="capacity-fill" style="width: 67%"></div>
                    </div>
                    <p>ä½¿ç”¨ç‡: 67% (67/100)</p>
                    <span class="status-badge active">æ­£å¸¸é‹è¡Œ</span>
                </div>
            </div>

            <div class="quick-actions">
                <button class="btn btn-primary" onclick="checkCapacity()">ğŸ” å®¹é‡æ ¡æ ¸</button>
                <button class="btn btn-success" onclick="optimizeAllocation()">âš¡ å„ªåŒ–é…ç½®</button>
                <button class="btn btn-warning" onclick="generateCapacityReport()">ğŸ“Š å®¹é‡å ±è¡¨</button>
            </div>

            <table class="data-table" id="warehouseTable">
                <thead>
                    <tr>
                        <th>å€‰åˆ¥</th>
                        <th>æº«å±¤</th>
                        <th>ç¸½æ£§æ¿ä½</th>
                        <th>å·²ä½¿ç”¨</th>
                        <th>ä½¿ç”¨ç‡</th>
                        <th>ç‹€æ…‹</th>
                        <th>æœ€å¾Œæ›´æ–°</th>
                        <th>æ“ä½œ</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- å‹•æ…‹è¼‰å…¥è³‡æ–™ -->
                </tbody>
            </table>
        </div>

        <!-- AIé æ¸¬ -->
        <div id="forecast" class="tab-content">
            <h2>ğŸ¤– AIé æ¸¬èˆ‡åƒæ•¸</h2>
            
            <div class="form-grid">
                <div class="form-group">
                    <label>é æ¸¬æ¨¡å‹ç‰ˆæœ¬</label>
                    <select id="modelVersion">
                        <option value="v2.1">GAI Model v2.1 (ç•¶å‰)</option>
                        <option value="v2.0">GAI Model v2.0</option>
                        <option value="v1.9">GAI Model v1.9</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>è¨“ç·´çª—å£ (å¤©)</label>
                    <input type="number" id="trainingWindow" value="90" min="30" max="365">
                </div>
                                <div class="form-group">
                    <label>ç½®ä¿¡å€é–“</label>
                    <select id="confidenceInterval">
                        <option value="95">95%</option>
                        <option value="97.5">97.5%</option>
                        <option value="99">99%</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>é æ¸¬æº–ç¢ºåº¦ (MAPE)</label>
                    <input type="text" id="mapeValue" value="2.8%" readonly>
                </div>
            </div>

            <div class="quick-actions">
                <button class="btn btn-primary" onclick="runForecast()">ğŸš€ åŸ·è¡Œé æ¸¬</button>
                <button class="btn btn-success" onclick="retrainModel()">ğŸ”„ é‡æ–°è¨“ç·´</button>
                <button class="btn btn-warning" onclick="validateForecast()">âœ… é©—è­‰é æ¸¬</button>
                <button class="btn btn-primary" onclick="exportForecast()">ğŸ“„ åŒ¯å‡ºé æ¸¬</button>
            </div>

            <table class="data-table" id="forecastTable">
                <thead>
                    <tr>
                        <th>SKUä»£ç¢¼</th>
                        <th>å“é …åç¨±</th>
                        <th>æ­·å²å¹³å‡éœ€æ±‚</th>
                        <th>é æ¸¬éœ€æ±‚</th>
                        <th>é æ¸¬æº–ç¢ºåº¦</th>
                        <th>ç½®ä¿¡å€é–“</th>
                        <th>é¢¨éšªç­‰ç´š</th>
                        <th>æ“ä½œ</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- å‹•æ…‹è¼‰å…¥è³‡æ–™ -->
                </tbody>
            </table>
        </div>

        <!-- å®‰å…¨åº«å­˜ç­–ç•¥ -->
        <div id="safety" class="tab-content">
            <h2>ğŸ›¡ï¸ å®‰å…¨åº«å­˜ç­–ç•¥</h2>
            
            <div class="form-grid">
                <div class="form-group">
                    <label>åº«å­˜ç­–ç•¥</label>
                    <select id="stockStrategy">
                        <option value="ROP">ROP (å†è¨‚è³¼é»)</option>
                        <option value="BaseStock">Base-stock (åŸºæº–åº«å­˜)</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>äº¤æœŸå‡å€¼ (å¤©)</label>
                    <input type="number" id="leadTimeMean" value="7" step="0.1">
                </div>
                <div class="form-group">
                    <label>äº¤æœŸæ¨™æº–å·® (å¤©)</label>
                    <input type="number" id="leadTimeStd" value="1.5" step="0.1">
                </div>
                <div class="form-group">
                    <label>æª¢è¦–é€±æœŸ (å¤©)</label>
                    <input type="number" id="reviewPeriod" value="7" min="1" max="30">
                </div>
            </div>

            <div class="form-group">
                <label>æœå‹™æ°´æº–å°æ‡‰Zå€¼è¨­å®š</label>
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>æœå‹™æ°´æº–</th>
                            <th>ç™¾åˆ†æ¯”</th>
                            <th>Zå€¼</th>
                            <th>èªªæ˜</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Pç´š</td>
                            <td>99.5%</td>
                            <td>2.58</td>
                            <td>é«˜åƒ¹å€¼å®¢æˆ¶</td>
                        </tr>
                        <tr>
                            <td>Qç´š</td>
                            <td>97.5%</td>
                            <td>1.96</td>
                            <td>ä¸€èˆ¬å®¢æˆ¶</td>
                        </tr>
                        <tr>
                            <td>Rç´š</td>
                            <td>95%</td>
                            <td>1.65</td>
                            <td>åŸºæœ¬å®¢æˆ¶</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <div class="quick-actions">
                <button class="btn btn-primary" onclick="calculateSafetyStock()">ğŸ§® è¨ˆç®—å®‰å…¨åº«å­˜</button>
                <button class="btn btn-success" onclick="runScenarioAnalysis()">ğŸ“Š æƒ…å¢ƒåˆ†æ</button>
                <button class="btn btn-warning" onclick="optimizeParameters()">âš¡ åƒæ•¸å„ªåŒ–</button>
            </div>

            <table class="data-table" id="safetyStockTable">
                <thead>
                    <tr>
                        <th>SKUä»£ç¢¼</th>
                        <th>å®¢æˆ¶ç­‰ç´š</th>
                        <th>å¹³å‡éœ€æ±‚</th>
                        <th>éœ€æ±‚æ¨™æº–å·®</th>
                        <th>Zå€¼</th>
                        <th>å®‰å…¨åº«å­˜</th>
                        <th>ROP/ç›®æ¨™åº«å­˜</th>
                        <th>æ“ä½œ</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- å‹•æ…‹è¼‰å…¥è³‡æ–™ -->
                </tbody>
            </table>
        </div>

        <!-- åº«å­˜å»ºè­° -->
        <div id="recommendation" class="tab-content">
            <h2>ğŸ’¡ åˆå§‹åº«å­˜å»ºè­° & æ¨¡æ“¬</h2>
            
            <div class="alert-grid">
                <div class="alert-card success">
                    <h4>âœ… å®¹é‡æ ¡æ ¸çµæœ</h4>
                    <p>å†·å‡åº«ç¸½å®¹é‡å……è¶³ï¼Œå†·è—åº«C-01éœ€æ³¨æ„å®¹é‡</p>
                    <small>æ ¡æ ¸æ™‚é–“: 2025-08-13 20:30</small>
                </div>
                <div class="alert-card warning">
                    <h4>âš ï¸ FEFOé¢¨éšªæé†’</h4>
                    <p>5å€‹SKUçš„åˆå§‹åº«å­˜å¯èƒ½ç„¡æ³•æ»¿è¶³æ•ˆæœŸè¦†è“‹è¦æ±‚</p>
                    <small>å»ºè­°èª¿æ•´è£œè²¨ç­–ç•¥</small>
                </div>
            </div>

            <div class="quick-actions">
                <button class="btn btn-primary" onclick="generateRecommendation()">ğŸ¯ ç”¢ç”Ÿå»ºè­°</button>
                <button class="btn btn-success" onclick="runCapacityCheck()">ğŸ” å®¹é‡æ ¡æ ¸</button>
                <button class="btn btn-warning" onclick="runSimulation()">ğŸ® æƒ…å¢ƒæ¨¡æ“¬</button>
                <button class="btn btn-primary" onclick="sendToCustomer()">ğŸ“§ é€å®¢æˆ¶ç¢ºèª</button>
            </div>

            <table class="data-table" id="recommendationTable">
                <thead>
                    <tr>
                        <th>SKUä»£ç¢¼</th>
                        <th>å®¢æˆ¶</th>
                        <th>å€‰åˆ¥/æº«å±¤</th>
                        <th>ç›®å‰åº«å­˜</th>
                        <th>å®‰å…¨åº«å­˜</th>
                        <th>ç›®æ¨™åº«å­˜</th>
                        <th>å»ºè­°è£œè²¨é‡</th>
                        <th>æ£§æ¿ä½å ç”¨</th>
                        <th>æ•ˆæœŸè¦†è“‹å¤©æ•¸</th>
                        <th>é¢¨éšªæ¨™è¨˜</th>
                        <th>æ“ä½œ</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- å‹•æ…‹è¼‰å…¥è³‡æ–™ -->
                </tbody>
            </table>
        </div>

        <!-- è£œå–®ç®¡ç† -->
        <div id="replenishment" class="tab-content">
            <h2>ğŸ“ è£œå–®èˆ‡æ´¾å·¥</h2>
            
            <div class="form-grid">
                <div class="form-group">
                    <label>è£œå–®ç·¨è™Ÿ</label>
                    <input type="text" id="replenishmentId" placeholder="ç³»çµ±è‡ªå‹•ç”¢ç”Ÿ" readonly>
                </div>
                <div class="form-group">
                    <label>ä¾›æ‡‰å•†</label>
                    <select id="supplier">
                        <option value="">è«‹é¸æ“‡ä¾›æ‡‰å•†</option>
                        <option value="supplier1">çµ±ä¸€ä¼æ¥­</option>
                        <option value="supplier2">ç¾©ç¾é£Ÿå“</option>
                        <option value="supplier3">æ„›ä¹‹å‘³</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>é è¨ˆäº¤æœŸ</label>
                    <input type="date" id="expectedDelivery">
                </div>
                <div class="form-group">
                    <label>æº«å±¤è»Šæ§½éœ€æ±‚</label>
                    <select id="vehicleType">
                        <option value="">è«‹é¸æ“‡è»Šå‹</option>
                        <option value="frozen">å†·å‡è»Š</option>
                        <option value="chilled">å†·è—è»Š</option>
                        <option value="mixed">æ··åˆè»Š</option>
                    </select>
                </div>
            </div>

            <div class="quick-actions">
                <button class="btn btn-primary" onclick="createReplenishmentOrder()">ğŸ“ å»ºç«‹è£œå–®</button>
                <button class="btn btn-success" onclick="publishOrder()">ğŸš€ ç™¼ä½ˆè£œå–®</button>
                <button class="btn btn-warning" onclick="generateWaveTask()">ğŸ“‹ ç”¢ç”Ÿæ³¢æ¬¡</button>
                <button class="btn btn-primary" onclick="notifySupplier()">ğŸ“§ é€šçŸ¥ä¾›æ‡‰å•†</button>
            </div>

            <table class="data-table" id="replenishmentTable">
                <thead>
                    <tr>
                        <th>è£œå–®ç·¨è™Ÿ</th>
                        <th>ä¾›æ‡‰å•†</th>
                        <th>SKUæ•¸é‡</th>
                        <th>ç¸½æ•¸é‡</th>
                        <th>é è¨ˆäº¤æœŸ</th>
                        <th>è»Šå‹éœ€æ±‚</th>
                        <th>ç‹€æ…‹</th>
                        <th>å»ºç«‹æ™‚é–“</th>
                        <th>æ“ä½œ</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- å‹•æ…‹è¼‰å…¥è³‡æ–™ -->
                </tbody>
            </table>
        </div>

        <!-- ç›£æ§å‘Šè­¦ -->
        <div id="monitoring" class="tab-content">
            <h2>ğŸ“ˆ åº«å­˜ç›£æ§èˆ‡å‘Šè­¦</h2>
            
            <div class="alert-grid">
                <div class="alert-card danger">
                    <h4>ğŸŒ¡ï¸ æº«åº¦ç•°å¸¸</h4>
                    <p>å†·å‡åº«F-02æº«åº¦ç•°å¸¸ï¼Œç›®å‰-15Â°C (æ¨™æº–-18Â°C)</p>
                    <small>ç•°å¸¸æ™‚é–“: 2025-08-13 19:45</small>
                    <button class="btn btn-warning" onclick="handleTemperatureAlert()">è™•ç†</button>
                </div>
                <div class="alert-card warning">
                    <h4>ğŸ“… æ•ˆæœŸé è­¦</h4>
                    <p>SKU-A001å°‡æ–¼3å¤©å¾Œåˆ°æœŸï¼Œåº«å­˜é‡50ç®±</p>
                    <small>å»ºè­°ç«‹å³åŸ·è¡ŒFEFOå‡ºè²¨</small>
                    <button class="btn btn-success" onclick="createFEFOTask()">å»ºç«‹FEFOä»»å‹™</button>
                </div>
                <div class="alert-card warning">
                    <h4>ğŸšš åœ¨é€”å»¶é²</h4>
                    <p>è£œå–®RO-20250813-001é è¨ˆä»Šæ—¥åˆ°è²¨ä½†å°šæœªå…¥åº«</p>
                    <small>ä¾›æ‡‰å•†: çµ±ä¸€ä¼æ¥­</small>
                    <button class="btn btn-primary" onclick="contactSupplier()">è¯çµ¡ä¾›æ‡‰å•†</button>
                </div>
                <div class="alert-card danger">
                    <h4>ğŸ“‰ ç¼ºè²¨é è­¦</h4>
                    <p>SKU-B002é è¨ˆ2å¤©å¾Œç¼ºè²¨ï¼Œéœ€ç·Šæ€¥è£œè²¨</p>
                    <small>ç›®å‰åº«å­˜: 10ç®±ï¼Œæ—¥å‡æ¶ˆè€—: 5ç®±</small>
                    <button class="btn btn-warning" onclick="emergencyReplenishment()">ç·Šæ€¥è£œè²¨</button>
                </div>
            </div>

            <div class="quick-actions">
                <button class="btn btn-primary" onclick="refreshMonitoring()">ğŸ”„ é‡æ–°æ•´ç†</button>
                <button class="btn btn-success" onclick="generateFEFOList()">ğŸ“‹ ç”¢ç”ŸFEFOæ¸…å–®</button>
                <button class="btn btn-warning" onclick="checkTemperature()">ğŸŒ¡ï¸ æº«åº¦æª¢æŸ¥</button>
                <button class="btn btn-primary" onclick="exportAlerts()">ğŸ“„ åŒ¯å‡ºå‘Šè­¦</button>
            </div>

            <table class="data-table" id="monitoringTable">
                <thead>
                    <tr>
                        <th>å‘Šè­¦é¡å‹</th>
                        <th>SKU/å€‰åˆ¥</th>
                        <th>æè¿°</th>
                        <th>åš´é‡ç¨‹åº¦</th>
                        <th>ç™¼ç”Ÿæ™‚é–“</th>
                        <th>ç‹€æ…‹</th>
                        <th>è² è²¬äºº</th>
                        <th>æ“ä½œ</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- å‹•æ…‹è¼‰å…¥è³‡æ–™ -->
                </tbody>
            </table>
        </div>
    </div>

    <script>
        // Google Apps Script Web App URL
        const GAS_URL = 'https://script.google.com/macros/s/AKfycbwud6sF2PUrHRf9lE8ccPWnNTAAsVUuF_WG3NdhgtXNcG3nTpfC1AGu15_7WtMssnoD/exec'
                  // å…¨åŸŸè®Šæ•¸
        let currentData = {};
        let isLoading = false;

        // åˆå§‹åŒ–é é¢
        document.addEventListener('DOMContentLoaded', function() {
            loadDashboardData();
            setInterval(refreshDashboard, 300000); // æ¯5åˆ†é˜è‡ªå‹•åˆ·æ–°
        });

        // é ç±¤åˆ‡æ›åŠŸèƒ½
        function showTab(tabName) {
            // éš±è—æ‰€æœ‰é ç±¤å…§å®¹
            const tabContents = document.querySelectorAll('.tab-content');
            tabContents.forEach(content => {
                content.classList.remove('active');
            });

            // ç§»é™¤æ‰€æœ‰æŒ‰éˆ•çš„activeç‹€æ…‹
            const navTabs = document.querySelectorAll('.nav-tab');
            navTabs.forEach(tab => {
                tab.classList.remove('active');
            });

            // é¡¯ç¤ºé¸ä¸­çš„é ç±¤
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');

            // è¼‰å…¥å°æ‡‰é ç±¤çš„è³‡æ–™
            loadTabData(tabName);
        }

        // è¼‰å…¥é ç±¤è³‡æ–™
        function loadTabData(tabName) {
            switch(tabName) {
                case 'dashboard':
                    loadDashboardData();
                    break;
                case 'customer':
                    loadCustomerData();
                    break;
                case 'project':
                    loadProjectData();
                    break;
                case 'sku':
                    loadSKUData();
                    break;
                case 'warehouse':
                    loadWarehouseData();
                    break;
                case 'forecast':
                    loadForecastData();
                    break;
                case 'safety':
                    loadSafetyStockData();
                    break;
                case 'recommendation':
                    loadRecommendationData();
                    break;
                case 'replenishment':
                    loadReplenishmentData();
                    break;
                case 'monitoring':
                    loadMonitoringData();
                    break;
            }
        }

        // APIå‘¼å«å‡½æ•¸
        async function callGAS(action, data = {}) {
    if (isLoading) return;
    
    isLoading = true;
    showLoading(true);
    
    try {
        console.log('ç™¼é€APIè«‹æ±‚:', action, 'URL:', GAS_URL);
        
        const response = await fetch(GAS_URL, {
            method: 'POST',
            mode: 'cors',
            cache: 'no-cache',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                action: action,
                data: data
            })
        });
        
        console.log('APIå›æ‡‰ç‹€æ…‹:', response.status, response.statusText);
        
        if (!response.ok) {
            throw new Error(`HTTP ${response.status}: ${response.statusText}`);
        }
        
        const result = await response.json();
        console.log('APIå›æ‡‰è³‡æ–™:', result);
        
        return result;
    } catch (error) {
        console.error('APIå‘¼å«è©³ç´°éŒ¯èª¤:', error);
        
        // è©³ç´°éŒ¯èª¤è™•ç†
        if (error.name === 'TypeError' && error.message.includes('Failed to fetch')) {
            alert('ç„¡æ³•é€£æ¥åˆ°ä¼ºæœå™¨ï¼Œè«‹æª¢æŸ¥ç¶²è·¯é€£ç·šæˆ–è¯ç¹«ç³»çµ±ç®¡ç†å“¡');
        } else if (error.message.includes('CORS')) {
            alert('è·¨åŸŸè«‹æ±‚è¢«é˜»æ“‹ï¼Œè«‹è¯ç¹«ç³»çµ±ç®¡ç†å“¡è¨­å®šCORSæ”¿ç­–');
        } else if (error.message.includes('HTTP')) {
            alert(`ä¼ºæœå™¨éŒ¯èª¤ï¼š${error.message}`);
        } else {
            alert(`ç³»çµ±éŒ¯èª¤ï¼š${error.message}`);
        }
        
        return {
            success: false,
            message: error.message,
            error: error.name
        };
    } finally {
        isLoading = false;
        showLoading(false);
    }
}

        // é¡¯ç¤ºè¼‰å…¥ç‹€æ…‹
        function showLoading(show) {
            const loadingElements = document.querySelectorAll('.loading');
            loadingElements.forEach(element => {
                if (show) {
                    element.classList.add('show');
                } else {
                    element.classList.remove('show');
                }
            });
        }

        // ä¸»æ§é åŠŸèƒ½
        async function loadDashboardData() {
            const result = await callGAS('getDashboardData');
            if (result && result.success) {
                updateKPICards(result.data.kpi);
                updateAlerts(result.data.alerts);
            }
        }

        function updateKPICards(kpiData) {
            if (!kpiData) return;
            
            document.getElementById('fillRate').textContent = kpiData.fillRate || '98.5%';
            document.getElementById('stockoutRate').textContent = kpiData.stockoutRate || '1.2%';
            document.getElementById('turnoverDays').textContent = kpiData.turnoverDays || '15.3';
            document.getElementById('freezerUtilization').textContent = kpiData.freezerUtilization || '76%';
            document.getElementById('chillerUtilization').textContent = kpiData.chillerUtilization || '82%';
            document.getElementById('expiringRate').textContent = kpiData.expiringRate || '3.1%';
        }

        function refreshDashboard() {
            loadDashboardData();
            showNotification('ä¸»æ§é å·²æ›´æ–°', 'success');
        }

        async function runAIForecast() {
            const result = await callGAS('runAIForecast');
            if (result && result.success) {
                showNotification('AIé æ¸¬åŸ·è¡Œå®Œæˆ', 'success');
                loadDashboardData();
            }
        }

        async function generateRecommendation() {
            const result = await callGAS('generateRecommendation');
            if (result && result.success) {
                showNotification('åº«å­˜å»ºè­°å·²ç”¢ç”Ÿ', 'success');
                showTab('recommendation');
            }
        }

        async function exportReport() {
            const result = await callGAS('exportReport');
            if (result && result.success) {
                // è§¸ç™¼æª”æ¡ˆä¸‹è¼‰
                const link = document.createElement('a');
                link.href = result.data.downloadUrl;
                link.download = `åº«å­˜å ±è¡¨_${new Date().toISOString().split('T')[0]}.xlsx`;
                link.click();
                showNotification('å ±è¡¨åŒ¯å‡ºå®Œæˆ', 'success');
            }
        }

        // å®¢æˆ¶éœ€æ±‚åŠŸèƒ½
        async function loadCustomerData() {
            const result = await callGAS('getCustomerData');
            if (result && result.success) {
                updateCustomerTable(result.data);
            }
        }

        async function saveCustomerDemand() {
            const customerData = {
                customer: document.getElementById('customerSelect').value,
                serviceLevel: document.getElementById('serviceLevel').value,
                itemList: document.getElementById('itemList').value
            };

            if (!customerData.customer || !customerData.serviceLevel) {
                alert('è«‹å¡«å¯«å¿…è¦æ¬„ä½');
                return;
            }

            const result = await callGAS('saveCustomerDemand', customerData);
            if (result && result.success) {
                showNotification('å®¢æˆ¶éœ€æ±‚å·²å„²å­˜', 'success');
                loadCustomerData();
                clearCustomerForm();
            }
        }

        async function importDemandFile() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.csv,.xlsx';
            input.onchange = async function(e) {
                const file = e.target.files[0];
                if (file) {
                    const formData = new FormData();
                    formData.append('file', file);
                    
                    const result = await callGAS('importDemandFile', {
                        fileName: file.name,
                        fileSize: file.size
                    });
                    
                    if (result && result.success) {
                        showNotification('æª”æ¡ˆåŒ¯å…¥å®Œæˆ', 'success');
                        loadCustomerData();
                    }
                }
            };
            input.click();
        }

        async function calculateSafetyStock() {
            const result = await callGAS('calculateSafetyStock');
            if (result && result.success) {
                showNotification('å®‰å…¨åº«å­˜è¨ˆç®—å®Œæˆ', 'success');
                showTab('safety');
            }
        }

        function updateCustomerTable(data) {
            const tbody = document.querySelector('#customerDemandTable tbody');
            tbody.innerHTML = '';
            
            if (data && data.length > 0) {
                data.forEach(item => {
                    const row = tbody.insertRow();
                    row.innerHTML = `
                        <td>${item.customer}</td>
                        <td>${item.itemCode}</td>
                        <td>${item.itemName}</td>
                        <td>${item.quantity}</td>
                        <td>${item.serviceLevel}</td>
                        <td><span class="status-badge ${item.status}">${getStatusText(item.status)}</span></td>
                        <td>
                            <button class="btn btn-primary" onclick="editCustomerDemand('${item.id}')">ç·¨è¼¯</button>
                            <button class="btn btn-warning" onclick="deleteCustomerDemand('${item.id}')">åˆªé™¤</button>
                        </td>
                    `;
                });
            }
        }

        function clearCustomerForm() {
            document.getElementById('customerSelect').value = '';
            document.getElementById('serviceLevel').value = '';
            document.getElementById('itemList').value = '';
        }

        // å¯„åº«å°ˆæ¡ˆåŠŸèƒ½
        async function loadProjectData() {
            const result = await callGAS('getProjectData');
            if (result && result.success) {
                updateProjectTable(result.data);
            }
        }

        async function saveProject() {
            const projectData = {
                name: document.getElementById('projectName').value,
                customer: document.getElementById('projectCustomer').value,
                warehouses: Array.from(document.getElementById('warehouseAssignment').selectedOptions).map(opt => opt.value),
                reviewCycle: document.getElementById('reviewCycle').value
            };

            if (!projectData.name || !projectData.customer) {
                alert('è«‹å¡«å¯«å¿…è¦æ¬„ä½');
                return;
            }

            const result = await callGAS('saveProject', projectData);
            if (result && result.success) {
                showNotification('å°ˆæ¡ˆå·²å»ºç«‹', 'success');
                loadProjectData();
                clearProjectForm();
            }
        }

        async function activateProject() {
            // å¯¦ä½œå°ˆæ¡ˆå•Ÿç”¨é‚è¼¯
            showNotification('å°ˆæ¡ˆå·²å•Ÿç”¨', 'success');
        }

        async function copyProject() {
            // å¯¦ä½œå°ˆæ¡ˆè¤‡è£½é‚è¼¯
            showNotification('å°ˆæ¡ˆå·²è¤‡è£½', 'success');
        }

        function updateProjectTable(data) {
            const tbody = document.querySelector('#projectTable tbody');
            tbody.innerHTML = '';
            
            if (data && data.length > 0) {
                data.forEach(item => {
                    const row = tbody.insertRow();
                    row.innerHTML = `
                        <td>${item.name}</td>
                        <td>${item.customer}</td>
                        <td>${item.warehouses.join(', ')}</td>
                        <td>${item.reviewCycle}</td>
                        <td><span class="status-badge ${item.status}">${getStatusText(item.status)}</span></td>
                        <td>${item.createTime}</td>
                        <td>
                            <button class="btn btn-primary" onclick="editProject('${item.id}')">ç·¨è¼¯</button>
                            <button class="btn btn-warning" onclick="deleteProject('${item.id}')">åˆªé™¤</button>
                        </td>
                    `;
                });
            }
        }

        function clearProjectForm() {
            document.getElementById('projectName').value = '';
            document.getElementById('projectCustomer').value = '';
            document.getElementById('warehouseAssignment').selectedIndex = -1;
            document.getElementById('reviewCycle').value = 'daily';
        }

        // SKUä¸»æª”åŠŸèƒ½
        async function loadSKUData() {
            const result = await callGAS('getSKUData');
            if (result && result.success) {
                updateSKUTable(result.data);
            }
        }

        async function saveSKU() {
            const skuData = {
                code: document.getElementById('skuCode').value,
                name: document.getElementById('skuName').value,
                temperatureZone: document.getElementById('temperatureZone').value,
                volume: parseFloat(document.getElementById('volume').value),
                weight: parseFloat(document.getElementById('weight').value),
                shelfLife: parseInt(document.getElementById('shelfLife').value)
            };

            if (!skuData.code || !skuData.name || !skuData.temperatureZone) {
                alert('è«‹å¡«å¯«å¿…è¦æ¬„ä½');
                return;
            }

            const result = await callGAS('saveSKU', skuData);
            if (result && result.success) {
                showNotification('SKUå·²å„²å­˜', 'success');
                loadSKUData();
                clearSKUForm();
            }
        }

        async function importSKUFile() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.csv,.xlsx';
            input.onchange = async function(e) {
                const file = e.target.files[0];
                if (file) {
                    const result = await callGAS('importSKUFile', {
                        fileName: file.name,
                        fileSize: file.size
                    });
                    
                    if (result && result.success) {
                        showNotification('SKUæª”æ¡ˆåŒ¯å…¥å®Œæˆ', 'success');
                        loadSKUData();
                    }
                }
            };
            input.click();
        }

        async function validateSKUData() {
            const result = await callGAS('validateSKUData');
            if (result && result.success) {
                showNotification(`è³‡æ–™é©—è­‰å®Œæˆï¼Œç™¼ç¾ ${result.data.errors} å€‹éŒ¯èª¤`, 
                    result.data.errors > 0 ? 'warning' : 'success');
            }
        }

        async function exportSKUData() {
            const result = await callGAS('exportSKUData');
            if (result && result.success) {
                const link = document.createElement('a');
                link.href = result.data.downloadUrl;
                link.download = `SKUä¸»æª”_${new Date().toISOString().split('T')[0]}.xlsx`;
                link.click();
                showNotification('SKUè³‡æ–™åŒ¯å‡ºå®Œæˆ', 'success');
            }
        }

        function updateSKUTable(data) {
            const tbody = document.querySelector('#skuTable tbody');
            tbody.innerHTML = '';
            
            if (data && data.length > 0) {
                data.forEach(item => {
                    const row = tbody.insertRow();
                    row.innerHTML = `
                        <td>${item.code}</td>
                        <td>${item.name}</td>
                        <td>${getTemperatureZoneText(item.temperatureZone)}</td>
                        <td>${item.volume}</td>
                        <td>${item.weight}</td>
                        <td>${item.shelfLife}</td>
                        <td><span class="status-badge ${item.status}">${getStatusText(item.status)}</span></td>
                        <td>
                            <button class="btn btn-primary" onclick="editSKU('${item.id}')">ç·¨è¼¯</button>
                            <button class="btn btn-warning" onclick="deleteSKU('${item.id}')">åˆªé™¤</button>
                        </td>
                    `;
                });
            }
        }

        function clearSKUForm() {
            document.getElementById('skuCode').value = '';
            document.getElementById('skuName').value = '';
            document.getElementById('temperatureZone').value = '';
            document.getElementById('volume').value = '';
            document.getElementById('weight').value = '';
            document.getElementById('shelfLife').value = '';
        }

        // å€‰å®¹ç®¡ç†åŠŸèƒ½
        async function loadWarehouseData() {
            const result = await callGAS('getWarehouseData');
            if (result && result.success) {
                updateWarehouseTable(result.data);
                updateWarehouseCards(result.data);
            }
        }

        async function checkCapacity() {
            const result = await callGAS('checkCapacity');
            if (result && result.success) {
                showNotification('å®¹é‡æ ¡æ ¸å®Œæˆ', 'success');
                loadWarehouseData();
            }
        }

        async function optimizeAllocation() {
            const result = await callGAS('optimizeAllocation');
            if (result && result.success) {
                showNotification('é…ç½®å„ªåŒ–å®Œæˆ', 'success');
                loadWarehouseData();
            }
        }

        async function generateCapacityReport() {
            const result = await callGAS('generateCapacityReport');
            if (result && result.success) {
                const link = document.createElement('a');
                link.href = result.data.downloadUrl;
                link.download = `å®¹é‡å ±è¡¨_${new Date().toISOString().split('T')[0]}.xlsx`;
                link.click();
                showNotification('å®¹é‡å ±è¡¨å·²ç”¢ç”Ÿ', 'success');
            }
        }

        function updateWarehouseTable(data) {
            const tbody = document.querySelector('#warehouseTable tbody');
            tbody.innerHTML = '';
            
            if (data && data.length > 0) {
                data.forEach(item => {
                    const row = tbody.insertRow();
                    const utilizationClass = item.utilization > 85 ? 'danger' : item.utilization > 75 ? 'warning' : 'active';
                    
                    row.innerHTML = `
                        <td>${item.warehouse}</td>
                        <td>${getTemperatureZoneText(item.temperatureZone)}</td>
                        <td>${item.totalPositions}</td>
                        <td>${item.usedPositions}</td>
                        <td><span class="status-badge ${utilizationClass}">${item.utilization}%</span></td>
                        <td><span class="status-badge ${item.status}">${getStatusText(item.status)}</span></td>
                        <td>${item.lastUpdate}</td>
                        <td>
                            <button class="btn btn-primary" onclick="editWarehouse('${item.id}')">ç·¨è¼¯</button>
                            <button class="btn btn-warning" onclick="adjustCapacity('${item.id}')">èª¿æ•´</button>
                        </td>
                    `;
                });
            }
        }

        function updateWarehouseCards(data) {
            // æ›´æ–°å€‰åº«å¡ç‰‡çš„å®¹é‡é¡¯ç¤º
            if (data && data.length > 0) {
                data.forEach(item => {
                    const card = document.querySelector(`[data-warehouse="${item.warehouse}"]`);
                    if (card) {
                        const capacityFill = card.querySelector('.capacity-fill');
                        const utilizationText = card.querySelector('.utilization-text');
                        
                        if (capacityFill) {
                            capacityFill.style.width = `${item.utilization}%`;
                            capacityFill.className = `capacity-fill ${item.utilization > 85 ? 'danger' : item.utilization > 75 ? 'warning' : ''}`;
                        }
                        
                        if (utilizationText) {
                            utilizationText.textContent = `ä½¿ç”¨ç‡: ${item.utilization}% (${item.usedPositions}/${item.totalPositions})`;
                        }
                    }
                });
            }
        }

        // AIé æ¸¬åŠŸèƒ½
        async function loadForecastData() {
            const result = await callGAS('getForecastData');
            if (result && result.success) {
                updateForecastTable(result.data);
            }
        }

        async function runForecast() {
            const forecastParams = {
                modelVersion: document.getElementById('modelVersion').value,
                trainingWindow: parseInt(document.getElementById('trainingWindow').value),
                confidenceInterval: parseFloat(document.getElementById('confidenceInterval').value)
            };

            const result = await callGAS('runForecast', forecastParams);
            if (result && result.success) {
                showNotification('AIé æ¸¬åŸ·è¡Œå®Œæˆ', 'success');
                loadForecastData();
                document.getElementById('mapeValue').value = result.data.mape + '%';
            }
        }

        async function retrainModel() {
            const result = await callGAS('retrainModel');
            if (result && result.success) {
                showNotification('æ¨¡å‹é‡æ–°è¨“ç·´å®Œæˆ', 'success');
                loadForecastData();
            }
        }

        async function validateForecast() {
            const result = await callGAS('validateForecast');
            if (result && result.success) {
                showNotification('é æ¸¬é©—è­‰å®Œæˆ', 'success');
            }
        }

        async function exportForecast() {
            const result = await callGAS('exportForecast');
            if (result && result.success) {
                const link = document.createElement('a');
                link.href = result.data.downloadUrl;
                link.download = `AIé æ¸¬çµæœ_${new Date().toISOString().split('T')[0]}.xlsx`;
                link.click();
                showNotification('é æ¸¬çµæœåŒ¯å‡ºå®Œæˆ', 'success');
            }
        }

        function updateForecastTable(data) {
            const tbody = document.querySelector('#forecastTable tbody');
            tbody.innerHTML = '';
            
            if (data && data.length > 0) {
                data.forEach(item => {
                    const row = tbody.insertRow();
                    const accuracyClass = item.accuracy > 95 ? 'active' : item.accuracy > 90 ? 'warning' : 'danger';
                    
                    row.innerHTML = `
                        <td>${item.skuCode}</td>
                        <td>${item.skuName}</td>
                        <td>${item.historicalDemand}</td>
                        <td>${item.forecastDemand}</td>
                        <td><span class="status-badge ${accuracyClass}">${item.accuracy}%</span></td>
                        <td>${item.confidenceInterval}</td>
                        <td><span class="status-badge ${item.riskLevel}">${getRiskLevelText(item.riskLevel)}</span></td>
                        <td>
                            <button class="btn btn-primary" onclick="viewForecastDetail('${item.id}')">è©³æƒ…</button>
                        </td>
                    `;
                });
            }
        }

        // å®‰å…¨åº«å­˜åŠŸèƒ½
        async function loadSafetyStockData() {
            const result = await callGAS('getSafetyStockData');
            if (result && result.success) {
                updateSafetyStockTable(result.data);
            }
        }

        async function runScenarioAnalysis() {
            const result = await callGAS('runScenarioAnalysis');
            if (result && result.success) {
                showNotification('æƒ…å¢ƒåˆ†æå®Œæˆ', 'success');
                loadSafetyStockData();
            }
        }

        async function optimizeParameters() {
            const result = await callGAS('optimizeParameters');
            if (result && result.success) {
                showNotification('åƒæ•¸å„ªåŒ–å®Œæˆ', 'success');
                loadSafetyStockData();
            }
        }

        function updateSafetyStockTable(data) {
            const tbody = document.querySelector('#safetyStockTable tbody');
            tbody.innerHTML = '';
            
            if (data && data.length > 0) {
                data.forEach(item => {
                    const row = tbody.insertRow();
                    row.innerHTML = `
                        <td>${item.skuCode}</td>
                        <td>${item.customerLevel}</td>
                        <td>${item.avgDemand}</td>
                        <td>${item.demandStd}</td>
                        <td>${item.zValue}</td>
                        <td>${item.safetyStock}</td>
                        <td>${item.targetStock}</td>
                        <td>
                            <button class="btn btn-primary" onclick="editSafetyStock('${item.id}')">ç·¨è¼¯</button>
                        </td>
                    `;
                });
            }
        }

        // åº«å­˜å»ºè­°åŠŸèƒ½
        async function loadRecommendationData() {
            const result = await callGAS('getRecommendationData');
            if (result && result.success) {
                updateRecommendationTable(result.data);
            }
        }

        async function runCapacityCheck() {
            const result = await callGAS('runCapacityCheck');
            if (result && result.success) {
                showNotification('å®¹é‡æ ¡æ ¸å®Œæˆ', 'success');
                loadRecommendationData();
            }
        }

        async function runSimulation() {
            const result = await callGAS('runSimulation');
            if (result && result.success) {
                showNotification('æƒ…å¢ƒæ¨¡æ“¬å®Œæˆ', 'success');
                loadRecommendationData();
            }
        }

        async function sendToCustomer() {
            const result = await callGAS('sendToCustomer');
            if (result && result.success) {
                showNotification('å»ºè­°å·²ç™¼é€çµ¦å®¢æˆ¶ç¢ºèª', 'success');
            }
        }

        function updateRecommendationTable(data) {
            const tbody = document.querySelector('#recommendationTable tbody');
            tbody.innerHTML = '';
            
            if (data && data.length > 0) {
                data.forEach(item => {
                    const row = tbody.insertRow();
                    row.innerHTML = `
                        <td>${item.skuCode}</td>
                        <td>${item.customer}</td>
                        <td>${item.warehouse}</td>
                        <td>${item.currentStock}</td>
                        <td>${item.safetyStock}</td>
                        <td>${item.targetStock}</td>
                        <td>${item.recommendedQty}</td>
                        <td>${item.palletPositions}</td>
                        <td>${item.shelfLifeDays}</td>
                        <td><span class="status-badge ${item.riskLevel}">${item.riskTags}</span></td>
                        <td>
                            <button class="btn btn-primary" onclick="approveRecommendation('${item.id}')">æ ¸å‡†</button>
                            <button class="btn btn-warning" onclick="adjustRecommendation('${item.id}')">èª¿æ•´</button>
                        </td>
                    `;
                });
            }
        }

        // è£œå–®ç®¡ç†åŠŸèƒ½
        async function loadReplenishmentData() {
            const result = await callGAS('getReplenishmentData');
            if (result && result.success) {
                updateReplenishmentTable(result.data);
            }
        }

        async function createReplenishmentOrder() {
            const orderData = {
                supplier: document.getElementById('supplier').value,
                expectedDelivery: document.getElementById('expectedDelivery').value,
                vehicleType: document.getElementById('vehicleType').value
            };

            if (!orderData.supplier || !orderData.expectedDelivery) {
                alert('è«‹å¡«å¯«å¿…è¦æ¬„ä½');
                return;
            }

            const result = await callGAS('createReplenishmentOrder', orderData);
            if (result && result.success) {
                showNotification('è£œå–®å·²å»ºç«‹', 'success');
                document.getElementById('replenishmentId').value = result.data.orderId;
                loadReplenishmentData();
            }
        }

        async function publishOrder() {
            const result = await callGAS('publishOrder');
            if (result && result.success) {
                showNotification('è£œå–®å·²ç™¼ä½ˆ', 'success');
                loadReplenishmentData();
            }
        }

        async function generateWaveTask() {
            const result = await callGAS('generateWaveTask');
            if (result && result.success) {
                showNotification('å…¥åº«æ³¢æ¬¡å·²ç”¢ç”Ÿ', 'success');
            }
        }

        async function notifySupplier() {
            const result = await callGAS('notifySupplier');
            if (result && result.success) {
                showNotification('ä¾›æ‡‰å•†é€šçŸ¥å·²ç™¼é€', 'success');
            }
        }

        function updateReplenishmentTable(data) {
            const tbody = document.querySelector('#replenishmentTable tbody');
            tbody.innerHTML = '';
            
            if (data && data.length > 0) {
                data.forEach(item => {
                    const row = tbody.insertRow();
                    row.innerHTML = `
                        <td>${item.orderId}</td>
                        <td>${item.supplier}</td>
                        <td>${item.skuCount}</td>
                        <td>${item.totalQty}</td>
                        <td>${item.expectedDelivery}</td>
                        <td>${item.vehicleType}</td>
                        <td><span class="status-badge ${item.status}">${getStatusText(item.status)}</span></td>
                        <td>${item.createTime}</td>
                        <td>
                            <button class="btn btn-primary" onclick="viewOrder('${item.id}')">æª¢è¦–</button>
                            <button class="btn btn-warning" onclick="editOrder('${item.id}')">ç·¨è¼¯</button>
                        </td>
                    `;
                });
            }
        }

        // ç›£æ§å‘Šè­¦åŠŸèƒ½
        async function loadMonitoringData() {
            const result = await callGAS('getMonitoringData');
            if (result && result.success) {
                updateMonitoringTable(result.data);
            }
        }

        async function refreshMonitoring() {
            loadMonitoringData();
            showNotification('ç›£æ§è³‡æ–™å·²æ›´æ–°', 'success');
        }

        async function generateFEFOList() {
            const result = await callGAS('generateFEFOList');
            if (result && result.success) {
                showNotification('FEFOæ¸…å–®å·²ç”¢ç”Ÿ', 'success');
            }
        }

        async function checkTemperature() {
            const result = await callGAS('checkTemperature');
            if (result && result.success) {
                showNotification('æº«åº¦æª¢æŸ¥å®Œæˆ', 'success');
                loadMonitoringData();
            }
        }

        async function exportAlerts() {
            const result = await callGAS('exportAlerts');
            if (result && result.success) {
                const link = document.createElement('a');
                link.href = result.data.downloadUrl;
                link.download = `å‘Šè­¦å ±è¡¨_${new Date().toISOString().split('T')[0]}.xlsx`;
                link.click();
                showNotification('å‘Šè­¦å ±è¡¨åŒ¯å‡ºå®Œæˆ', 'success');
            }
        }

        // å‘Šè­¦è™•ç†åŠŸèƒ½
        async function handleTemperatureAlert() {
            const result = await callGAS('handleTemperatureAlert');
            if (result && result.success) {
                showNotification('æº«åº¦ç•°å¸¸è™•ç†å®Œæˆ', 'success');
                loadMonitoringData();
            }
        }

                async function createFEFOTask() {
            const result = await callGAS('createFEFOTask');
            if (result && result.success) {
                showNotification('FEFOä»»å‹™å·²å»ºç«‹', 'success');
                loadMonitoringData();
            }
        }

        async function contactSupplier() {
            const result = await callGAS('contactSupplier');
            if (result && result.success) {
                showNotification('å·²è¯çµ¡ä¾›æ‡‰å•†', 'success');
            }
        }

        async function emergencyReplenishment() {
            const result = await callGAS('emergencyReplenishment');
            if (result && result.success) {
                showNotification('ç·Šæ€¥è£œè²¨å·²å•Ÿå‹•', 'success');
                showTab('replenishment');
            }
        }

        function updateMonitoringTable(data) {
            const tbody = document.querySelector('#monitoringTable tbody');
            tbody.innerHTML = '';
            
            if (data && data.length > 0) {
                data.forEach(item => {
                    const row = tbody.insertRow();
                    const severityClass = item.severity === 'high' ? 'danger' : item.severity === 'medium' ? 'warning' : 'active';
                    
                    row.innerHTML = `
                        <td>${getAlertTypeText(item.alertType)}</td>
                        <td>${item.target}</td>
                        <td>${item.description}</td>
                        <td><span class="status-badge ${severityClass}">${getSeverityText(item.severity)}</span></td>
                        <td>${item.occurTime}</td>
                        <td><span class="status-badge ${item.status}">${getStatusText(item.status)}</span></td>
                        <td>${item.assignee}</td>
                        <td>
                            <button class="btn btn-primary" onclick="handleAlert('${item.id}')">è™•ç†</button>
                            <button class="btn btn-warning" onclick="assignAlert('${item.id}')">æŒ‡æ´¾</button>
                        </td>
                    `;
                });
            }
        }

        // é€šç”¨å·¥å…·å‡½æ•¸
        function getStatusText(status) {
            const statusMap = {
                'active': 'æ­£å¸¸',
                'warning': 'è­¦å‘Š',
                'danger': 'ç•°å¸¸',
                'pending': 'å¾…è™•ç†',
                'processing': 'è™•ç†ä¸­',
                'completed': 'å·²å®Œæˆ',
                'cancelled': 'å·²å–æ¶ˆ'
            };
            return statusMap[status] || status;
        }

        function getTemperatureZoneText(zone) {
            const zoneMap = {
                'frozen': 'å†·å‡ (-18Â°C)',
                'chilled': 'å†·è— (0-4Â°C)',
                'ambient': 'å¸¸æº«'
            };
            return zoneMap[zone] || zone;
        }

        function getRiskLevelText(level) {
            const levelMap = {
                'low': 'ä½é¢¨éšª',
                'medium': 'ä¸­é¢¨éšª',
                'high': 'é«˜é¢¨éšª'
            };
            return levelMap[level] || level;
        }

        function getAlertTypeText(type) {
            const typeMap = {
                'temperature': 'æº«åº¦ç•°å¸¸',
                'expiry': 'æ•ˆæœŸé è­¦',
                'stockout': 'ç¼ºè²¨é è­¦',
                'capacity': 'å®¹é‡ç•°å¸¸',
                'delay': 'å»¶é²å‘Šè­¦'
            };
            return typeMap[type] || type;
        }

        function getSeverityText(severity) {
            const severityMap = {
                'low': 'ä½',
                'medium': 'ä¸­',
                'high': 'é«˜'
            };
            return severityMap[severity] || severity;
        }

        // é€šçŸ¥åŠŸèƒ½
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: ${type === 'success' ? '#d4edda' : type === 'warning' ? '#fff3cd' : type === 'danger' ? '#f8d7da' : '#d1ecf1'};
                color: ${type === 'success' ? '#155724' : type === 'warning' ? '#856404' : type === 'danger' ? '#721c24' : '#0c5460'};
                border: 1px solid ${type === 'success' ? '#c3e6cb' : type === 'warning' ? '#ffeaa7' : type === 'danger' ? '#f5c6cb' : '#bee5eb'};
                padding: 15px 20px;
                border-radius: 8px;
                box-shadow: 0 4px 15px rgba(0,0,0,0.1);
                z-index: 10000;
                max-width: 300px;
                animation: slideIn 0.3s ease;
            `;
            notification.textContent = message;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.animation = 'slideOut 0.3s ease';
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.parentNode.removeChild(notification);
                    }
                }, 300);
            }, 3000);
        }

        // ç·¨è¼¯åŠŸèƒ½
        async function editCustomerDemand(id) {
            const result = await callGAS('getCustomerDemandById', {id: id});
            if (result && result.success) {
                const data = result.data;
                document.getElementById('customerSelect').value = data.customer;
                document.getElementById('serviceLevel').value = data.serviceLevel;
                document.getElementById('itemList').value = data.itemList;
                
                // å°‡å„²å­˜æŒ‰éˆ•æ”¹ç‚ºæ›´æ–°æŒ‰éˆ•
                const saveBtn = document.querySelector('[onclick="saveCustomerDemand()"]');
                saveBtn.textContent = 'æ›´æ–°éœ€æ±‚';
                saveBtn.setAttribute('onclick', `updateCustomerDemand('${id}')`);
            }
        }

        async function updateCustomerDemand(id) {
            const customerData = {
                id: id,
                customer: document.getElementById('customerSelect').value,
                serviceLevel: document.getElementById('serviceLevel').value,
                itemList: document.getElementById('itemList').value
            };

            const result = await callGAS('updateCustomerDemand', customerData);
            if (result && result.success) {
                showNotification('å®¢æˆ¶éœ€æ±‚å·²æ›´æ–°', 'success');
                loadCustomerData();
                clearCustomerForm();
                
                // æ¢å¾©å„²å­˜æŒ‰éˆ•
                const updateBtn = document.querySelector('[onclick^="updateCustomerDemand"]');
                updateBtn.textContent = 'å„²å­˜éœ€æ±‚';
                updateBtn.setAttribute('onclick', 'saveCustomerDemand()');
            }
        }

        async function deleteCustomerDemand(id) {
            if (confirm('ç¢ºå®šè¦åˆªé™¤æ­¤å®¢æˆ¶éœ€æ±‚å—ï¼Ÿ')) {
                const result = await callGAS('deleteCustomerDemand', {id: id});
                if (result && result.success) {
                    showNotification('å®¢æˆ¶éœ€æ±‚å·²åˆªé™¤', 'success');
                    loadCustomerData();
                }
            }
        }

        // å…¶ä»–ç·¨è¼¯åŠŸèƒ½é¡ä¼¼å¯¦ä½œ
        async function editProject(id) {
            // å¯¦ä½œå°ˆæ¡ˆç·¨è¼¯åŠŸèƒ½
            showNotification('å°ˆæ¡ˆç·¨è¼¯åŠŸèƒ½é–‹ç™¼ä¸­', 'info');
        }

        async function deleteProject(id) {
            if (confirm('ç¢ºå®šè¦åˆªé™¤æ­¤å°ˆæ¡ˆå—ï¼Ÿ')) {
                const result = await callGAS('deleteProject', {id: id});
                if (result && result.success) {
                    showNotification('å°ˆæ¡ˆå·²åˆªé™¤', 'success');
                    loadProjectData();
                }
            }
        }

        async function editSKU(id) {
            // å¯¦ä½œSKUç·¨è¼¯åŠŸèƒ½
            showNotification('SKUç·¨è¼¯åŠŸèƒ½é–‹ç™¼ä¸­', 'info');
        }

        async function deleteSKU(id) {
            if (confirm('ç¢ºå®šè¦åˆªé™¤æ­¤SKUå—ï¼Ÿ')) {
                const result = await callGAS('deleteSKU', {id: id});
                if (result && result.success) {
                    showNotification('SKUå·²åˆªé™¤', 'success');
                    loadSKUData();
                }
            }
        }

        async function editWarehouse(id) {
            // å¯¦ä½œå€‰åº«ç·¨è¼¯åŠŸèƒ½
            showNotification('å€‰åº«ç·¨è¼¯åŠŸèƒ½é–‹ç™¼ä¸­', 'info');
        }

        async function adjustCapacity(id) {
            // å¯¦ä½œå®¹é‡èª¿æ•´åŠŸèƒ½
            showNotification('å®¹é‡èª¿æ•´åŠŸèƒ½é–‹ç™¼ä¸­', 'info');
        }

        async function viewForecastDetail(id) {
            // å¯¦ä½œé æ¸¬è©³æƒ…æª¢è¦–åŠŸèƒ½
            showNotification('é æ¸¬è©³æƒ…åŠŸèƒ½é–‹ç™¼ä¸­', 'info');
        }

        async function editSafetyStock(id) {
            // å¯¦ä½œå®‰å…¨åº«å­˜ç·¨è¼¯åŠŸèƒ½
            showNotification('å®‰å…¨åº«å­˜ç·¨è¼¯åŠŸèƒ½é–‹ç™¼ä¸­', 'info');
        }

        async function approveRecommendation(id) {
            const result = await callGAS('approveRecommendation', {id: id});
            if (result && result.success) {
                showNotification('å»ºè­°å·²æ ¸å‡†', 'success');
                loadRecommendationData();
            }
        }

        async function adjustRecommendation(id) {
            // å¯¦ä½œå»ºè­°èª¿æ•´åŠŸèƒ½
            showNotification('å»ºè­°èª¿æ•´åŠŸèƒ½é–‹ç™¼ä¸­', 'info');
        }

        async function viewOrder(id) {
            // å¯¦ä½œè¨‚å–®æª¢è¦–åŠŸèƒ½
            showNotification('è¨‚å–®æª¢è¦–åŠŸèƒ½é–‹ç™¼ä¸­', 'info');
        }

        async function editOrder(id) {
            // å¯¦ä½œè¨‚å–®ç·¨è¼¯åŠŸèƒ½
            showNotification('è¨‚å–®ç·¨è¼¯åŠŸèƒ½é–‹ç™¼ä¸­', 'info');
        }

        async function handleAlert(id) {
            const result = await callGAS('handleAlert', {id: id});
            if (result && result.success) {
                showNotification('å‘Šè­¦å·²è™•ç†', 'success');
                loadMonitoringData();
            }
        }

        async function assignAlert(id) {
            // å¯¦ä½œå‘Šè­¦æŒ‡æ´¾åŠŸèƒ½
            showNotification('å‘Šè­¦æŒ‡æ´¾åŠŸèƒ½é–‹ç™¼ä¸­', 'info');
        }

        // CSSå‹•ç•«
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideIn {
                from {
                    transform: translateX(100%);
                    opacity: 0;
                }
                to {
                    transform: translateX(0);
                    opacity: 1;
                }
            }
            
            @keyframes slideOut {
                from {
                    transform: translateX(0);
                    opacity: 1;
                }
                to {
                    transform: translateX(100%);
                    opacity: 0;
                }
            }
        `;
        document.head.appendChild(style);

        // éµç›¤å¿«æ·éµ
        document.addEventListener('keydown', function(e) {
            // Ctrl + R: é‡æ–°æ•´ç†ç•¶å‰é é¢
            if (e.ctrlKey && e.key === 'r') {
                e.preventDefault();
                const activeTab = document.querySelector('.tab-content.active');
                if (activeTab) {
                    const tabName = activeTab.id;
                    loadTabData(tabName);
                    showNotification('é é¢å·²é‡æ–°æ•´ç†', 'success');
                }
            }
            
            // Ctrl + S: å„²å­˜ç•¶å‰è¡¨å–®
            if (e.ctrlKey && e.key === 's') {
                e.preventDefault();
                const activeTab = document.querySelector('.tab-content.active');
                if (activeTab) {
                    const tabName = activeTab.id;
                    switch(tabName) {
                        case 'customer':
                            saveCustomerDemand();
                            break;
                        case 'project':
                            saveProject();
                            break;
                        case 'sku':
                            saveSKU();
                            break;
                    }
                }
            }
        });

        // é é¢å¯è¦‹æ€§è®ŠåŒ–æ™‚é‡æ–°è¼‰å…¥è³‡æ–™
        document.addEventListener('visibilitychange', function() {
            if (!document.hidden) {
                const activeTab = document.querySelector('.tab-content.active');
                if (activeTab && activeTab.id === 'dashboard') {
                    loadDashboardData();
                }
            }
        });

        // éŸ¿æ‡‰å¼è¨­è¨ˆè™•ç†
        function handleResize() {
            const container = document.querySelector('.container');
            if (window.innerWidth < 768) {
                container.classList.add('mobile');
            } else {
                container.classList.remove('mobile');
            }
        }

        window.addEventListener('resize', handleResize);
        handleResize(); // åˆå§‹åŸ·è¡Œ

        // è¡¨å–®é©—è­‰
        function validateForm(formData, requiredFields) {
            const errors = [];
            
            requiredFields.forEach(field => {
                if (!formData[field] || formData[field].toString().trim() === '') {
                    errors.push(`${field} ç‚ºå¿…å¡«æ¬„ä½`);
                }
            });
            
            return errors;
        }

        // è³‡æ–™æ ¼å¼åŒ–
        function formatDate(dateString) {
            if (!dateString) return '';
            const date = new Date(dateString);
            return date.toLocaleDateString('zh-TW');
        }

        function formatNumber(number, decimals = 0) {
            if (number === null || number === undefined) return '';
            return Number(number).toFixed(decimals);
        }

        function formatCurrency(amount) {
            if (!amount) return '';
            return new Intl.NumberFormat('zh-TW', {
                style: 'currency',
                currency: 'TWD'
            }).format(amount);
        }

        // æœ¬åœ°å„²å­˜åŠŸèƒ½
        function saveToLocalStorage(key, data) {
            try {
                localStorage.setItem(key, JSON.stringify(data));
            } catch (error) {
                console.error('å„²å­˜åˆ°æœ¬åœ°å„²å­˜å¤±æ•—:', error);
            }
        }

        function loadFromLocalStorage(key) {
            try {
                const data = localStorage.getItem(key);
                return data ? JSON.parse(data) : null;
            } catch (error) {
                console.error('å¾æœ¬åœ°å„²å­˜è¼‰å…¥å¤±æ•—:', error);
                return null;
            }
        }

        // åŒ¯å‡ºåŠŸèƒ½
        function exportTableToCSV(tableId, filename) {
            const table = document.getElementById(tableId);
            if (!table) return;
            
            const rows = table.querySelectorAll('tr');
            const csvContent = [];
            
            rows.forEach(row => {
                const cols = row.querySelectorAll('th, td');
                const rowData = [];
                cols.forEach(col => {
                    rowData.push(col.textContent.trim());
                });
                csvContent.push(rowData.join(','));
            });
            
            const blob = new Blob([csvContent.join('\n')], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = filename || 'export.csv';
            link.click();
        }

        // åˆ—å°åŠŸèƒ½
        function printTable(tableId) {
            const table = document.getElementById(tableId);
            if (!table) return;
            
            const printWindow = window.open('', '_blank');
            printWindow.document.write(`
                <html>
                <head>
                    <title>åˆ—å°å ±è¡¨</title>
                    <style>
                        table { border-collapse: collapse; width: 100%; }
                        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
                        th { background-color: #f2f2f2; }
                        @media print {
                            body { margin: 0; }
                        }
                    </style>
                </head>
                <body>
                    <h2>GAIå¯„åº«åº«å­˜é‡æ°´ä½è£œå–®ç³»çµ± - å ±è¡¨</h2>
                    ${table.outerHTML}
                </body>
                </html>
            `);
            printWindow.document.close();
            printWindow.print();
        }

        // æœå°‹åŠŸèƒ½
        function searchTable(tableId, searchTerm) {
            const table = document.getElementById(tableId);
            if (!table) return;
            
            const rows = table.querySelectorAll('tbody tr');
            const term = searchTerm.toLowerCase();
            
            rows.forEach(row => {
                const text = row.textContent.toLowerCase();
                if (text.includes(term)) {
                    row.style.display = '';
                } else {
                    row.style.display = 'none';
                }
            });
        }

        // æ’åºåŠŸèƒ½
        function sortTable(tableId, columnIndex, ascending = true) {
            const table = document.getElementById(tableId);
            if (!table) return;
            
            const tbody = table.querySelector('tbody');
            const rows = Array.from(tbody.querySelectorAll('tr'));
            
            rows.sort((a, b) => {
                const aText = a.cells[columnIndex].textContent.trim();
                const bText = b.cells[columnIndex].textContent.trim();
                
                // å˜—è©¦æ•¸å­—æ¯”è¼ƒ
                const aNum = parseFloat(aText);
                const bNum = parseFloat(bText);
                
                if (!isNaN(aNum) && !isNaN(bNum)) {
                    return ascending ? aNum - bNum : bNum - aNum;
                }
                
                // æ–‡å­—æ¯”è¼ƒ
                return ascending ? aText.localeCompare(bText) : bText.localeCompare(aText);
            });
            
            // é‡æ–°æ’å…¥æ’åºå¾Œçš„è¡Œ
            rows.forEach(row => tbody.appendChild(row));
        }

        // æ‰¹æ¬¡æ“ä½œ
        function selectAllRows(tableId, checked) {
            const table = document.getElementById(tableId);
            if (!table) return;
            
            const checkboxes = table.querySelectorAll('tbody input[type="checkbox"]');
            checkboxes.forEach(checkbox => {
                checkbox.checked = checked;
            });
        }

        function getSelectedRows(tableId) {
            const table = document.getElementById(tableId);
            if (!table) return [];
            
            const selectedRows = [];
            const checkboxes = table.querySelectorAll('tbody input[type="checkbox"]:checked');
            
            checkboxes.forEach(checkbox => {
                const row = checkbox.closest('tr');
                if (row) {
                    selectedRows.push(row);
                }
            });
            
            return selectedRows;
        }

        // ç³»çµ±ç‹€æ…‹æª¢æŸ¥
        async function checkSystemStatus() {
            try {
                const result = await callGAS('checkSystemStatus');
                if (result && result.success) {
                    updateSystemStatus(result.data);
                }
            } catch (error) {
                console.error('ç³»çµ±ç‹€æ…‹æª¢æŸ¥å¤±æ•—:', error);
            }
        }

        function updateSystemStatus(statusData) {
            // æ›´æ–°ç³»çµ±ç‹€æ…‹é¡¯ç¤º
            const statusIndicator = document.querySelector('.system-status');
            if (statusIndicator && statusData) {
                statusIndicator.className = `system-status ${statusData.status}`;
                statusIndicator.textContent = statusData.message;
            }
        }

        // å®šæœŸæª¢æŸ¥ç³»çµ±ç‹€æ…‹
        setInterval(checkSystemStatus, 60000); // æ¯åˆ†é˜æª¢æŸ¥ä¸€æ¬¡

        console.log('GAIå¯„åº«åº«å­˜é‡æ°´ä½è£œå–®ç³»çµ±å‰ç«¯è¼‰å…¥å®Œæˆ');
    </script>
</body>
</html>
